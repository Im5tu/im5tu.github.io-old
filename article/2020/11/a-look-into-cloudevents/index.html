<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart Blackler"><meta name=description content="A look into what CloudEvents are, and how they can be used as a internal format for messaging"><meta name=keywords content=",cncf,messaging"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://im5tu.io/article/2020/11/a-look-into-cloudevents/><title>A Look Into CloudEvents :: Stuart Blackler's Blog</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css><meta itemprop=name content="A Look Into CloudEvents"><meta itemprop=description content="A look into what CloudEvents are, and how they can be used as a internal format for messaging"><meta itemprop=datePublished content="2020-11-21T11:34:07+00:00"><meta itemprop=dateModified content="2020-11-21T11:34:07+00:00"><meta itemprop=wordCount content="968"><meta itemprop=keywords content="cncf,messaging,"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Look Into CloudEvents"><meta name=twitter:description content="A look into what CloudEvents are, and how they can be used as a internal format for messaging"><meta property="og:title" content="A Look Into CloudEvents"><meta property="og:description" content="A look into what CloudEvents are, and how they can be used as a internal format for messaging"><meta property="og:type" content="article"><meta property="og:url" content="https://im5tu.io/article/2020/11/a-look-into-cloudevents/"><meta property="article:published_time" content="2020-11-21T11:34:07+00:00"><meta property="article:modified_time" content="2020-11-21T11:34:07+00:00"><meta property="article:section" content="development"><meta property="article:published_time" content="2020-11-21 11:34:07 +0000 UTC"><link rel=alternate type=application/rss+xml href=https://im5tu.io/article/2020/11/a-look-into-cloudevents/index.xml title="Stuart Blackler's Blog"><meta property="og:image" content="https://im5tu.io/img/profile.jpg"><meta property="og:site_name" content="Stuart Blackler's Blog"><link rel=alternate type=application/rss+xml href=/index.xml title="Stuart Blackler's Blog"><link rel=preconnect href=https://api.github.com><link rel=preconnect href=https://partner.googleadservices.com><link rel=preconnect href=https://tpc.googlesyndication.com><link rel=preconnect href=https://www.googletagservices.com><link rel=preconnect href=https://googleads.g.doubleclick.net><link rel=preconnect href=https://pagead2.googlesyndication.com><link rel=preload href=/fonts/Inter-UI-Bold.woff2><link rel=preload href=/fonts/Inter-UI-Regular.woff2><style>.post{max-width:1200px}.header__inner{width:100%;max-width:1160px}.toolbar{display:none!important}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border-left:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2;border-radius:0;border-bottom-left-radius:10px;transition:all 250ms ease;margin:-18px;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}table{width:100%;border-collapse:collapse}table th{background-color:#cecece;color:#222}table tr{margin:0;padding:0}table tr:first-child{border-left:1px solid #acacac;border-top:1px solid #acacac;border-right:1px solid #acacac}table tr td:first-child{border-left:1px solid #acacac}table tr td:last-child{border-right:1px solid #acacac}table td,table th{padding:.5em;border-bottom:1px solid #acacac;margin:0}h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{text-decoration:none}h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover{text-decoration:underline}@media print{.copy-code-button{display:none}}@media(prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}}</style><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-88036425-1','auto');ga('send','pageview');</script><script data-ad-client=ca-pub-8597760177900459 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>im5tu.io</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/article/>Articles</a></li><li><a href=/article/index.xml>RSS Feed</a></li><li><a href=https://bit.ly/im5tu-tw>Twitter</a></li><li><a href=https://bit.ly/im5tu-yt>YouTube</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>5 minutes</p></div><article><h1 class=post-title><a href=https://im5tu.io/article/2020/11/a-look-into-cloudevents/>A Look Into CloudEvents</a></h1><div class=post-content><p>Over the past few months, I&rsquo;ve been looking into the internal architecture setup for <a href=https://checkout.com>Checkout.com</a> and seeing how we can scale it for the next few years. As part of that research, I&rsquo;ve been looking into the CloudEvents specification as a potential option as the basis for a common event schema across teams.</p><h2 id=what-are-cloudevents>What are CloudEvents?</h2><p>CloudEvents is a <a href=https://www.cncf.io/projects/>Cloud Native Computing Foundation</a> incubating project that provides <a href=https://github.com/cloudevents/spec/blob/master/spec.md>a specification</a> for describing event data in a common way ensuring that teams have consistency in their applications, helping to reduce some of the errors traditionally faced and simplifying integrations. Traditionally, different teams & third-party providers have different structures to their events, even with the same organisation.</p><p>CloudEvents, at its core, defines a set of metadata, called attributes, about the event being transferred between systems, and how those pieces of metadata should appear in that message. This metadata is meant to be the minimal set of information needed to route the request to the proper component and to facilitate proper processing of the event by that component. <em>(<a href=https://github.com/cloudevents/spec/blob/master/primer.md#design-goals>Source</a>)</em></p><p>Interestingly, the CloudEvents project also explicitly lists the non-goals for the project (ie: the stuff that&rsquo;s out of scope):</p><ul><li>Function build and invocation process</li><li>Language-specific runtime APIs</li><li>Selecting a single identity/access control system</li><li>Inclusion of protocol-level routing information</li><li>Event persistence processes</li><li>Mechanism for Authorization, Data Integrity and Confidentiality</li></ul><h2 id=what-does-a-cloudevent-look-like>What does a CloudEvent look like?</h2><p>As all CloudEvents implementations must support the JSON format, we can take a look at a minimal payload here:</p><pre><code class=language-json>{
    &quot;id&quot;: &quot;A234-1234-1234&quot;,
    &quot;source&quot;: &quot;https://github.com/cloudevents/spec/pull&quot;,
    &quot;specversion&quot;: &quot;1.x-wip&quot;,
    &quot;type&quot;: &quot;com.github.pull_request.opened&quot;
}
</code></pre><p>All of the fields listed above are required in all formats of CloudEvents. The <code>id</code> field identifies the event which producers ensure is unique for a given <code>source</code>. The <code>source</code> identifies the context in which an event happened. Often this will include information such as the type of the event source, the organization publishing the event or the process that produced the event. The <code>specversion</code> describes the version of the CloudEvents specification that the event adheres to.</p><p>The specification also includes some additional optional attributes, which can be seen here:</p><pre><code class=language-json>{
    &quot;id&quot;: &quot;A234-1234-1234&quot;,
    &quot;source&quot;: &quot;https://github.com/cloudevents/spec/pull&quot;,
    &quot;specversion&quot;: &quot;1.x-wip&quot;,
    &quot;type&quot;: &quot;com.github.pull_request.opened&quot;,
    &quot;data&quot;: &quot;&lt;much wow=\&quot;xml\&quot;/&gt;&quot;,
    &quot;datacontenttype&quot;: &quot;text/xml&quot;,
    &quot;dataschema&quot;: &quot;/teams/sega/cloud_event.json&quot;,
    &quot;subject&quot;: &quot;et_245435943&quot;,
    &quot;time&quot;: &quot;2019-10-12T07:20:50.52Z&quot;
}
</code></pre><p>Should a producer want to include domain specific information about the event occurrence, they must encapsulate this information inside of the <code>data</code> field. The <code>datacontenttype</code> field will then describe the format of the data field, for example <code>application/json</code>. If the <code>datacontenttype</code> field is omitted, then its assumed that the <code>data</code> field, if present, is of type <code>application/json</code>. Another field that directly relates to the data field, if present, is <code>dataschema</code>. This field identifies the schema that the <code>data</code> field adheres to, as a URI reference. The <code>subject</code> field describes the object/instance that the event is in reference to within the context of the producer. In other words, it could be the name of a EC2 instance, a file in Azure blob storage or a user id. Lastly, the <code>time</code> field is the timestamp in format of <a href=https://tools.ietf.org/html/rfc3339>RFC 3339</a> (eg: <code>2019-10-12T07:20:50.52Z</code> (ISO8601 compatible) or <code>2019-10-12 07:20:50.52Z</code> (<strong>not</strong> ISO8601 compatible)) of when the event occurred.</p><p>The <a href=https://github.com/cloudevents/spec/blob/master/json-format.md>json format</a> also allows for messages to be batched together. When this occurs, the <code>type</code> field must be set to <code>application/cloudevents-batch+json</code>. See the <a href=https://github.com/cloudevents/spec/blob/master/json-format.md#43-examples>example shown here</a>.</p><h3 id=duplicationidempotency>Duplication/Idempotency</h3><p>Earlier, I mentioned that the <code>id</code> field identifies the event which producers ensure is unique for a given <code>source</code>. If a duplicate event is re-sent (eg: retry of a queue) it may have the same id. How the consumers handle this is up to them and largely depends on the context of the event. For example: if we are sending a new UserCreated event in the system, it will usually be safe to treat this as an idempotent event using the <code>id</code> as the idempotency key. It&rsquo;s always up to the consumer to decide whether or not multiple events with the same <code>source</code> and <code>id</code> combination are treated as duplicates or not.</p><h2 id=transports>Transports</h2><p>CloudEvents may be sent across a variety of transport mechanisms, including:</p><ul><li><a href=https://github.com/cloudevents/spec/blob/master/amqp-protocol-binding.md>AMQP</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/http-protocol-binding.md>HTTP</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/mqtt-protocol-binding.md>MQTT</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/nats-protocol-binding.md>NATS</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/kafka-protocol-binding.md>Kafka</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/websockets-protocol-binding.md>WebSockets</a></li></ul><p>The specification doesn&rsquo;t explicitly include vendor specific transports like Azure Service Bus or SQS. CloudEvents can be mapped to these vendor specific transports pretty easily by using the <a href=https://github.com/cloudevents/spec/blob/master/http-protocol-binding.md>HTTP</a> as a guide for this.</p><h2 id=formats>Formats</h2><p>As mentioned earlier, any implementation must support the JSON format, presumably because it&rsquo;s one of the most widely used formats today. However, the specification details two other formats: <a href=https://github.com/cloudevents/spec/blob/master/avro-format.md>Avro</a> & <a href=https://github.com/cloudevents/spec/blob/master/protobuf-format.md>Protobuf</a>.</p><p>The format that services decide to use is up to them, so long as the specification is followed. This allows great flexibility in the way systems are built.</p><h2 id=specification-extensions>Specification extensions</h2><p>Like any specification, it&rsquo;s never a case of one size fits all. The CloudEvents specification allows itself to be extended. An extension adds additional attributes to the message so long as they follow the same naming convention and type system as the standard attributes. A number of extensions for some common use cases have already been documented:</p><ul><li><a href=https://github.com/cloudevents/spec/blob/master/extensions/dataref.md>Dataref (Claim Check Pattern)</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/extensions/distributed-tracing.md>Distributed Tracing</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/extensions/partitioning.md>Partitioning</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/extensions/sampled-rate.md>Sampling</a></li><li><a href=https://github.com/cloudevents/spec/blob/master/extensions/sequence.md>Sequence</a></li></ul><p>To write a custom extension, <a href=https://github.com/cloudevents/spec/blob/master/documented-extensions.md>check here</a> first for prior art and implementation information.</p><h2 id=sdk-support>SDK Support</h2><p>At the time of writing, there are six different SDK&rsquo;s at the moment to help people produce and consume CloudEvents:</p><ol><li><a href=https://github.com/cloudevents/sdk-go>GO</a></li><li><a href=https://github.com/cloudevents/sdk-javascript>Javascript</a></li><li><a href=https://github.com/cloudevents/sdk-java>Java</a></li><li><a href=https://github.com/cloudevents/sdk-csharp>C#</a></li><li><a href=https://github.com/cloudevents/sdk-ruby>Ruby</a></li><li><a href=https://github.com/cloudevents/sdk-python>Python</a></li></ol><p>I think it&rsquo;s definitely worth teams looking into the use of CloudEvents as an interoperability mechanism between teams that need to consume each others events. The specification may also be looked at with other CNCF projects, like the Serverless Workflow specification. There&rsquo;s definitely a lot more that I need to go and unpack with the CloudEvents specification, but at a high level, I really like the approach that&rsquo;s been taken and I hope you do as well.</p><p>You can <a href=https://github.com/cloudevents/spec/blob/master/spec.md>read the full specification here</a>.</p></div></article><hr><div><p><i>If you haven't already, subscribe to my new <a href=https://bit.ly/im5tu-yt target=_blank>YouTube Channel</a>, Code With Stu. Here you'll find different tip, tricks and tutorials using some of the latest technologies, in bitesize chunks.</i></p></div><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://im5tu.io/tags/cncf>cncf</a></span><span class=tag><a href=https://im5tu.io/tags/messaging>messaging</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>968 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-11-21 11:34 +0000</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://im5tu.io/article/2020/11/using-moq-with-ref-in-and-out-parameters-in-c/><span class=button__icon>←</span>
<span class=button__text>Using Moq with ref, in and out parameters in C#</span></a></span>
<span class="button next"><a href=https://im5tu.io/article/2020/10/setting-up-a-repository-template-in-github-for-k6/><span class=button__text>Setting Up A Repository Template In Github For K6</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=Im5tu/im5tu-hugo issue-term=url label=Comment theme=photon-dark crossorigin=anonymous async></script></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://im5tu.io/>Stuart Blackler</a></span>
<span><a href=https://im5tu.io/article/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Theme made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj+AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script><script src=/js/site-20c12b24.js defer></script></body></html>