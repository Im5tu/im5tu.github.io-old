<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Canonical host urls with URL Rewrite - Stuart Blackler&#39;s Blog</title>
    <link rel="canonical" href="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <meta name="description" content="A quick explanition of canonical host urls and how to achieve them with url rewriting.">
    
    
    <meta property="og:title" content="Canonical host urls with URL Rewrite - Stuart Blackler&#39;s Blog" />
<meta property="og:type" content="website" />

<meta property="og:description" content="A quick explanition of canonical host urls and how to achieve them with url rewriting.">

<meta property="og:url" content="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/" />
<meta property="og:image" content="https://im5tu.io/img/profile.jpg" />
<meta property="og:site_name" content="Stuart Blackler&#39;s Blog" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@im5tu" />

<style>body,html{height:100%;color:#303030;font-family:"Noto Sans","Helvetica Neue",Helvetica,Arial,sans-serif;font-display:auto;line-height:1.8em}h1,h2,h3,h4,h5,h6{font-family:Comfortaa,"Helvetica Neue",Helvetica,Arial,sans-serif;font-display:auto}p{margin:1.5em 0}blockquote{border-left:5px solid #454545;background-color:#fafafa;padding:.5em 1.5em}blockquote,blockquote p{color:#494949}blockquote~blockquote{margin-top:0;margin-bottom:0}.pageContainer{text-align:justify}.pageWrap{margin:0 auto;max-width:1400px}@media screen and (min-width:320px){.pageWrap{width:97%}}@media screen and (min-width:740px){.pageWrap{width:90%}}@media screen and (min-width:980px){.pageWrap{width:80%}}.pageWrap:after{content:"";display:table;clear:both}a{font-family:Comfortaa,"Helvetica Neue",Helvetica,Arial,sans-serif;font-display:auto}a:link,a:visited{color:#149fd1}a:link{text-decoration:none}a:hover{color:#2db9eb;text-decoration:underline}#pageHeader-about{border-bottom:1px solid #eaeaea}#pageHeader-about-title a{font-size:1.2em}#pageHeader-about-title a:link,#pageHeader-about-title a:visited{color:#232323}#pageHeader-about-title a:first-child{font-size:1.1em;color:#149fd1;text-transform:none}.article-list a{color:#0a0a0a}.article-list a:hover{color:#2db9eb;text-decoration:underline}.article-content li code,.article-content p code{color:#149fd1;background-color:rgba(27,31,35,.05)}.article-content li code:hover,.article-content p code:hover{opacity:.5}.article img{max-width:100%}ul.article-tags{display:inline;padding:0}ul.article-tags li{display:inline;padding:0 1em}ul.article-tags li a:link{text-decoration:underline}table{width:100%}table *{padding:0;margin:0}table th{display:-webkit-box;display:flex;width:100%;background:#000;color:#fff;padding:1em}table tr{display:-webkit-box;display:flex;width:100%}table tr:hover{opacity:.7}table tr:first-child{padding:0}table tr:nth-of-type(odd){background:#eee}table td{-webkit-box-flex:1;flex:1 1 20%;text-align:left;padding:1em}pre{line-height:1.4em}code{font-size:1.2em}@media (prefers-color-scheme:dark){body,html{color:#eaeaea;background:#323232}h1,h2,h3,h4,h5,h6{color:#fefefe}#pageHeader-about-title a:link,#pageHeader-about-title a:visited{color:#dedede}#pageHeader-about-title a:first-child{color:#149fd1}table tr:nth-of-type(odd){background:#767676}pre,pre code{background:#dcdcdc!important;color:#323232}}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border:1px solid #e2e2e2;border-radius:0 0 10px 10px;-webkit-transition:all 250ms ease;transition:all 250ms ease;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}@media print{.copy-code-button{display:none}}@media (prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}}</style>
<link href="https://fonts.googleapis.com/css?family=Comfortaa|Noto+Sans&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/tomorrow.min.css" rel="stylesheet"><link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Stuart Blackler&#39;s Blog" /></head>
<body>
<section class="pageContainer">
    <header id="pageHeader">
    <section id="pageHeader-about" class="pageWrap" itemscope itemtype="http://schema.org/person">
        <section id="pageHeader-about-title">
            <h1 itemprop="name"><a href="/" title="Stuart Blackler">@im5tu</a> / <a href="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/">Canonical host urls with URL Rewrite</a></h1>
        </section>
    </section>
</header>
    <section class="pageContainer-content pageWrap">
        <article class="article" itemscope itemtype="http://schema.org/blog">
    <section class="article-content" itemprop="text"><p>In the <a href="/article/2017/06/up-and-running-with-url-rewrite---going-from-http-to-https/">previous post</a>, I gave a brief intoduction to URL Rewriting and showed you how to get from HTTP to HTTPS. In this article, I will show you how to have a canonical host url.<!-- raw HTML omitted --></p>
<h2 id="what-is-a-canonical-host-url">What is a canonical host url?</h2>
<p>It can be incredibly easy to distribute different urls for your website. Lets say that we have <code>www.site.com/post1</code> and <code>site.com/post1</code>. If you're a search engine, you think that these are different different pages with the same content. When you have the same content, you ranking decreases because the content is not original. As a human looking at the site, we think that the pages are the same content on the same site, so we don't see the duplication.</p>
<p>So a canonical url is basically saying to the search engine: hey, <code>www.site.com/post1</code> and <code>site.com/post1</code> are the same content and you should access me through this link (<em>which we define to be a single one of the above</em>).</p>
<p>We can set this through metadata on our webpages, but this doesn't guarentee that people will distribute the correct link to your site. To fix this, we can rewrite the url to either append or remove the <code>www.</code>. In this case, because I prefer shorter url's, we will remove the www sub-domain prefix.</p>
<h2 id="making-a-canonical-host-url-via-url-rewrite">Making a canonical host url via URL Rewrite</h2>
<p>As per the snippet in our previous post, we are going to create an inbound rule (which lives under <code>system.web &gt; rewrite &gt; rules</code> in our <code>web.config</code>):</p>
<pre><code class="language-xml">&lt;rule name=&quot;Canonical Hostname&quot; stopProcessing=&quot;true&quot;&gt;
    &lt;match url=&quot;(.*)&quot; /&gt;
    &lt;conditions logicalGrouping=&quot;MatchAll&quot; trackAllCaptures=&quot;false&quot;&gt;
        &lt;add input=&quot;{HTTP_HOST}&quot; pattern=&quot;^www\.([.a-zA-Z0-9]+)$&quot;/&gt;
    &lt;/conditions&gt;
    &lt;action type=&quot;Redirect&quot; url=&quot;https://{C:1}/{R:1}&quot; redirectType=&quot;Temporary&quot; /&gt;
&lt;/rule&gt;
</code></pre>
<p>In the first line, we are defining the name of the rule which can be viewed inside of <code>inetmgr (IIS Manager)</code> saying that we want to stop at this rule and return the response to the client. Next up, we give our matching criteria which we have wildcarded to match all requests. Then we have added a condition which takes a server variable (<code>{HTTP_HOST}</code> which tells us the DNS name or IP address that has been used to reach this server eg: site.com or <a href="http://www.site.com),">www.site.com),</a> and we've matched it against any request starting with <code>www.</code>.</p>
<p>Finally, we define the action that we wish to take if both the <code>match</code> and <code>conditions</code> sections have been satisfied. The action that we wish to take is to redirect the user to a non <code>www.</code> version of the page. In order to do this, we use one of the capture groups (which comes from the conditions section regex) to redirect to (in this case it's <code>{C:1}</code>) and combine it with the original path and query.</p>
<p>And that's it, you should be redirecting people from say <code>www.site.com</code> to <code>site.com</code>.</p>
<h2 id="other-posts-in-this-series">Other Posts In This Series</h2>
<ol>
<li><a href="/article/2017/06/up-and-running-with-url-rewrite---going-from-http-to-https/">Up and running with URL Rewrite - going from HTTP to HTTPS</a></li>
<li><a href="/article/2017/06/canonical-host-urls-with-url-rewrite/">Canonical host urls with URL Rewrite</a> <em>(This Post)</em></li>
<li><a href="/article/2017/06/removing-trailing-slashes-with-url-rewrite/">Removing trailing slashes with URL Rewrite</a></li>
<li><a href="/article/2017/06/ensuring-httponly-cookies-with-url-rewrite/">Ensuring httpOnly cookies with URL Rewrite</a></li>
<li><a href="/article/2017/06/ensuring-secure-cookies-with-url-rewrite/">Ensuring secure cookies with URL Rewrite</a></li>
<li><a href="/article/2017/06/ensuring-samesite-cookies-with-url-rewrite/">Ensuring samesite cookies with URL Rewrite</a></li>
</ol>
</section>
    <footer class="article-footer">
        <hr />
Tags: <ul class="article-tags">
    <li><a class="article-tag" href="/tags/iis/">IIS</a></li><li><a class="article-tag" href="/tags/url-rewrite/">Url Rewrite</a></li><li><a class="article-tag" href="/tags/seo/">SEO</a></li>
</ul>
</footer>
</article>
    </section>
    <footer id="pageFooter" class="pageWrap">
    <p>&copy; 2020 <span itemprop="author">Stuart Blackler</span>. Last Updated: <time itemprop="datecreated" class="article-header-time" pubdate="pubdate" datetime="2017-06-04T15:00:55">2017-06-04 15:00:55 &#43;0100 BST</time>. <a id="pageFooter-scroll-link" href="#">Scroll To Top</a>.</p>
</footer>
</section>
<script src="/js/site-54e01995.js" defer></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-88036425-1', 'auto');
  ga('send', 'pageview');
</script>


<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>