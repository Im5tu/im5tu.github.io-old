<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="Stuart Blackler"><meta name=description content="A quick explanition of canonical host urls and how to achieve them with url rewriting."><meta name=keywords content=",IIS,Url Rewrite,SEO"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/><title>Canonical host urls with URL Rewrite :: Stuart Blackler's Blog</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css><meta itemprop=name content="Canonical host urls with URL Rewrite"><meta itemprop=description content="A quick explanition of canonical host urls and how to achieve them with url rewriting."><meta itemprop=datePublished content="2017-06-04T15:00:55+01:00"><meta itemprop=dateModified content="2017-06-04T15:00:55+01:00"><meta itemprop=wordCount content="449"><meta itemprop=keywords content="IIS,Url Rewrite,SEO,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Canonical host urls with URL Rewrite"><meta name=twitter:description content="A quick explanition of canonical host urls and how to achieve them with url rewriting."><meta property="og:title" content="Canonical host urls with URL Rewrite"><meta property="og:description" content="A quick explanition of canonical host urls and how to achieve them with url rewriting."><meta property="og:type" content="article"><meta property="og:url" content="https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/"><meta property="article:published_time" content="2017-06-04T15:00:55+01:00"><meta property="article:modified_time" content="2017-06-04T15:00:55+01:00"><meta property="article:section" content="Development"><meta property="article:published_time" content="2017-06-04 15:00:55 +0100 BST"><link rel=alternate type=application/rss+xml href=https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/index.xml title="Stuart Blackler's Blog"><meta property="og:image" content="https://im5tu.io/img/profile.jpg"><meta property="og:site_name" content="Stuart Blackler's Blog"><link rel=alternate type=application/rss+xml href=/index.xml title="Stuart Blackler's Blog"><link rel=preconnect href=https://api.github.com><link rel=preconnect href=https://partner.googleadservices.com><link rel=preconnect href=https://tpc.googlesyndication.com><link rel=preconnect href=https://www.googletagservices.com><link rel=preconnect href=https://googleads.g.doubleclick.net><link rel=preconnect href=https://pagead2.googlesyndication.com><link rel=preload href=/fonts/Inter-UI-Bold.woff2><link rel=preload href=/fonts/Inter-UI-Regular.woff2><style>.post{max-width:1200px}.header__inner{width:100%;max-width:1160px}.toolbar{display:none!important}.copy-code-button{float:right;display:block;padding:8px 12px;font-size:.9em;background-color:#e2e2e2;border-left:1px solid #e2e2e2;border-bottom:1px solid #e2e2e2;border-radius:0;border-bottom-left-radius:10px;transition:all 250ms ease;margin:-18px;opacity:0}.copy-code-button:hover{cursor:pointer;opacity:.7;border-style:solid}.copy-code-button:focus{background-color:#e2e2e2;outline:0;border-style:solid}.copy-code-button:active{background-color:#e2e2e2;opacity:.5;border-style:solid}pre:hover .copy-code-button{opacity:1}.copy-code-button~pre{position:relative}table{width:100%;border-collapse:collapse}table th{background-color:#cecece;color:#222}table tr{margin:0;padding:0}table tr:first-child{border-left:1px solid #acacac;border-top:1px solid #acacac;border-right:1px solid #acacac}table tr td:first-child{border-left:1px solid #acacac}table tr td:last-child{border-right:1px solid #acacac}table td,table th{padding:.5em;border-bottom:1px solid #acacac;margin:0}h2 a:link,h2 a:visited,h3 a:link,h3 a:visited,h4 a:link,h4 a:visited,h5 a:link,h5 a:visited{text-decoration:none}h2 a:hover,h3 a:hover,h4 a:hover,h5 a:hover{text-decoration:underline}@media print{.copy-code-button{display:none}}@media(prefers-color-scheme:dark){.copy-code-button{background-color:#969696;color:#323232}}</style><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-88036425-1','auto');ga('send','pageview');</script><script data-ad-client=ca-pub-8597760177900459 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>im5tu.io</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/article/>Articles</a></li><li><a href=/article/index.xml>RSS Feed</a></li><li><a href=https://bit.ly/im5tu-tw>Twitter</a></li><li><a href=https://bit.ly/im5tu-yt>YouTube</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 minutes</p></div><article><h1 class=post-title><a href=https://im5tu.io/article/2017/06/canonical-host-urls-with-url-rewrite/>Canonical host urls with URL Rewrite</a></h1><div class=post-content><section class="series series-header"><p><i>This article is part of the <a href=#series>Url Rewriting</a> series. You are reading part 2 of 6.</i></p></section><p>In the <a href=/article/2017/06/up-and-running-with-url-rewrite---going-from-http-to-https/>previous post</a>, I gave a brief intoduction to URL Rewriting and showed you how to get from HTTP to HTTPS. In this article, I will show you how to have a canonical host url.</p><h2 id=what-is-a-canonical-host-url>What is a canonical host url?</h2><p>It can be incredibly easy to distribute different urls for your website. Lets say that we have <code>www.site.com/post1</code> and <code>site.com/post1</code>. If you&rsquo;re a search engine, you think that these are different different pages with the same content. When you have the same content, you ranking decreases because the content is not original. As a human looking at the site, we think that the pages are the same content on the same site, so we don&rsquo;t see the duplication.</p><p>So a canonical url is basically saying to the search engine: hey, <code>www.site.com/post1</code> and <code>site.com/post1</code> are the same content and you should access me through this link (<em>which we define to be a single one of the above</em>).</p><p>We can set this through metadata on our webpages, but this doesn&rsquo;t guarentee that people will distribute the correct link to your site. To fix this, we can rewrite the url to either append or remove the <code>www.</code>. In this case, because I prefer shorter url&rsquo;s, we will remove the www sub-domain prefix.</p><h2 id=making-a-canonical-host-url-via-url-rewrite>Making a canonical host url via URL Rewrite</h2><p>As per the snippet in our previous post, we are going to create an inbound rule (which lives under <code>system.web > rewrite > rules</code> in our <code>web.config</code>):</p><pre><code class=language-xml>&lt;rule name=&quot;Canonical Hostname&quot; stopProcessing=&quot;true&quot;&gt;
    &lt;match url=&quot;(.*)&quot; /&gt;
    &lt;conditions logicalGrouping=&quot;MatchAll&quot; trackAllCaptures=&quot;false&quot;&gt;
        &lt;add input=&quot;{HTTP_HOST}&quot; pattern=&quot;^www\.([.a-zA-Z0-9]+)$&quot;/&gt;
    &lt;/conditions&gt;
    &lt;action type=&quot;Redirect&quot; url=&quot;https://{C:1}/{R:1}&quot; redirectType=&quot;Temporary&quot; /&gt;
&lt;/rule&gt;
</code></pre><p>In the first line, we are defining the name of the rule which can be viewed inside of <code>inetmgr (IIS Manager)</code> saying that we want to stop at this rule and return the response to the client. Next up, we give our matching criteria which we have wildcarded to match all requests. Then we have added a condition which takes a server variable (<code>{HTTP_HOST}</code> which tells us the DNS name or IP address that has been used to reach this server eg: site.com or <a href=http://www.site.com>www.site.com</a>), and we&rsquo;ve matched it against any request starting with <code>www.</code>.</p><p>Finally, we define the action that we wish to take if both the <code>match</code> and <code>conditions</code> sections have been satisfied. The action that we wish to take is to redirect the user to a non <code>www.</code> version of the page. In order to do this, we use one of the capture groups (which comes from the conditions section regex) to redirect to (in this case it&rsquo;s <code>{C:1}</code>) and combine it with the original path and query.</p><p>And that&rsquo;s it, you should be redirecting people from say <code>www.site.com</code> to <code>site.com</code>.</p></div></article><hr><div><p><i>If you haven't already, subscribe to my new <a href=https://bit.ly/im5tu-yt target=_blank>YouTube Channel</a>, Code With Stu. Here you'll find different tip, tricks and tutorials using some of the latest technologies, in bitesize chunks.</i></p></div><hr><div class=post-info><a name=series></a><b>More in the Url Rewriting series:</b><ol><li><a href=/article/2017/06/up-and-running-with-url-rewrite-going-from-http-to-https/>Up and running with URL Rewrite - going from HTTP to HTTPS</a></li><li>Canonical host urls with URL Rewrite <i>(This article)</i></li><li><a href=/article/2017/06/removing-trailing-slashes-with-url-rewrite/>Removing trailing slashes with URL Rewrite</a></li><li><a href=/article/2017/06/ensuring-httponly-cookies-with-url-rewrite/>Ensuring httpOnly cookies with URL Rewrite</a></li><li><a href=/article/2017/06/ensuring-secure-cookies-with-url-rewrite/>Ensuring secure cookies with URL Rewrite</a></li><li><a href=/article/2017/06/ensuring-samesite-cookies-with-url-rewrite/>Ensuring samesite cookies with URL Rewrite</a></li></ol><p><a href=/article>View All Articles</a></p><hr><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://im5tu.io/tags/iis>IIS</a></span><span class=tag><a href=https://im5tu.io/tags/url-rewrite>Url Rewrite</a></span><span class=tag><a href=https://im5tu.io/tags/seo>SEO</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>449 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2017-06-04 15:00 +0100</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://im5tu.io/article/2017/06/removing-trailing-slashes-with-url-rewrite/><span class=button__icon>←</span>
<span class=button__text>Removing trailing slashes with URL Rewrite</span></a></span>
<span class="button next"><a href=https://im5tu.io/article/2017/06/up-and-running-with-url-rewrite-going-from-http-to-https/><span class=button__text>Up and running with URL Rewrite - going from HTTP to HTTPS</span>
<span class=button__icon>→</span></a></span></div></div><script src=https://utteranc.es/client.js repo=Im5tu/im5tu-hugo issue-term=url label=Comment theme=photon-dark crossorigin=anonymous async></script></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2021</span>
<span><a href=https://im5tu.io/>Stuart Blackler</a></span>
<span><a href=https://im5tu.io/article/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Theme made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.af435e44374f1e99a669ea8cd5bb9a2fceed80588941a451bfddb66b86a67c9f40b0f417e9543a763f809aa7e9300d7b1d69bf99615810ba02ac70396d50fad5.js integrity="sha512-r0NeRDdPHpmmaeqM1buaL87tgFiJQaRRv922a4amfJ9AsPQX6VQ6dj+AmqfpMA17HWm/mWFYELoCrHA5bVD61Q=="></script><script src=/js/site-20c12b24.js defer></script></body></html>